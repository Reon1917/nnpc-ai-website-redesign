---
import Layout from "../layouts/main.astro";
import heroImage from "../assets/hero-image/nnpc_hero_img_3.png";
import companyLogo from "../assets/company-logos/ccEnterprise.png";
import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Hero from "../components/homePage/hero";
import About from "../components/homePage/about";
import Partners from "../components/homePage/partners";
import Industries from "../components/homePage/industries";
import Consultation from "../components/homePage/consultation.astro";
import Footer from "../components/homePage/footer";
import NavBar from "@/components/site/NavBar.astro";

type HomeEntry = CollectionEntry<"home">;
type HomeData = HomeEntry["data"];
type HomeSection = HomeData["section"];
type HomeDataBySection<T extends HomeSection> = Extract<HomeData, { section: T }>;
type HomeEntryBySection<T extends HomeSection> = Omit<HomeEntry, "data"> & {
	data: HomeDataBySection<T>;
};

const getHomeEntry = async <T extends HomeSection>(section: T) => {
	const entry = await getEntry("home", section);
	if (!entry) {
		throw new Error(`Missing home ${section} content.`);
	}
	if (entry.data.section !== section) {
		throw new Error(`Mismatched home ${section} content.`);
	}
	return entry as HomeEntryBySection<T>;
};

const heroEntry = await getHomeEntry("hero");
const hero = heroEntry.data;
const heroHtml = heroEntry.rendered?.html ?? "";

const aboutEntry = await getHomeEntry("about");
const about = aboutEntry.data;
const aboutHtml = aboutEntry.rendered?.html ?? "";

const partnersEntry = await getHomeEntry("partners");
const partners = partnersEntry.data;

const industriesEntry = await getHomeEntry("industries");
const industries = industriesEntry.data;

const consultationEntry = await getHomeEntry("consultation");
const consultation = consultationEntry.data;

const footerEntry = await getHomeEntry("footer");
const footer = footerEntry.data;

---

<Layout title="NNPC AI - Industrial Automation & Intelligence">
	<NavBar />
	<div class="nnpc-page">
		<Hero
			eyebrow={hero.eyebrow}
			title={hero.title}
			lead={hero.lead}
			bodyHtml={heroHtml}
			ctaPrimary={hero.ctaPrimary}
			ctaSecondary={hero.ctaSecondary}
			imageSrc={heroImage.src}
			imageWidth={heroImage.width}
			imageHeight={heroImage.height}
		/>

		<About
			eyebrow={about.eyebrow}
			title={about.title}
			accent={about.accent}
			caption={about.caption}
			bodyHtml={aboutHtml}
		/>

		<Partners
			eyebrow={partners.eyebrow}
			title={partners.title}
			description={partners.description}
			items={partners.items}
		/>

		<Industries
			eyebrow={industries.eyebrow}
			title={industries.title}
			items={industries.items}
		/>

		<Consultation eyebrow={consultation.eyebrow} title={consultation.title} />

		<Footer
			logoSrc={companyLogo.src}
			logoWidth={companyLogo.width}
			logoHeight={companyLogo.height}
			logoAlt="Chin Chun Enterprise logo"
			blurb={footer.blurb}
			legalHtml={footer.legal}
		/>
	</div>
</Layout>

<style is:global>
	.nnpc-page {
		--gold: #f1c84b;
		--gold-dim: #c9a640;
		--gold-ink: #7a5a08;
		--ink: #141414;
		--ink-deep: #0a0a0a;
		--surface: #ffffff;
		--ivory: #fbf8f1;
		--stone: #d3cbbd;
		background: radial-gradient(
			circle at 20% -15%,
			#fff4d2 0%,
			#f8f3ea 38%,
			#f1ede4 100%
		);
		color: #141414;
	}

	.nnpc-hero {
		position: relative;
		display: flex;
		min-height: 100vh;
		background-color: #f6f2e9;
		isolation: isolate;
	}

	.nnpc-hero-media {
		position: absolute;
		inset: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: center 35%;
		opacity: 1;
		z-index: 0;
	}

	.nnpc-hero-overlay {
		position: absolute;
		inset: 0;
		background: linear-gradient(
			180deg,
			rgba(255, 255, 255, 0.82) 0%,
			rgba(255, 255, 255, 0.55) 45%,
			rgba(247, 242, 232, 0.78) 100%
		);
		z-index: 1;
	}

	.nnpc-hero-inner {
		min-height: 100vh;
		justify-content: center;
	}

	.nnpc-section {
		position: relative;
	}

	.nnpc-section-light {
		background: linear-gradient(135deg, #ffffff 0%, #f5f1e8 100%);
		color: #141414;
	}

	.nnpc-section-dark {
		background: linear-gradient(135deg, #fbf7ee 0%, #f2ede2 100%);
		color: #141414;
	}

	.nnpc-grid {
		position: absolute;
		inset: 0;
		background-image:
			linear-gradient(rgba(10, 10, 10, 0.05) 1px, transparent 1px),
			linear-gradient(90deg, rgba(10, 10, 10, 0.05) 1px, transparent 1px);
		background-size: 40px 40px;
		opacity: 0.25;
		pointer-events: none;
	}

	.nnpc-panel {
		background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(244, 239, 228, 0.85));
		border: 1px solid rgba(14, 14, 14, 0.08);
		box-shadow: 0 20px 45px rgba(24, 18, 5, 0.12);
	}

	.nnpc-hero-main {
		max-width: 44rem;
	}

	.nnpc-hero-main h1 {
		letter-spacing: 0.08em;
		text-transform: uppercase;
		text-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
	}

	.nnpc-btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		padding: 0.9rem 2rem;
		border-radius: 0.35rem;
		font-size: 0.85rem;
		font-weight: 700;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
	}

	.nnpc-btn-primary {
		background: var(--gold);
		color: #1d1605;
		box-shadow: 0 15px 35px rgba(241, 200, 75, 0.35);
	}

	.nnpc-btn-primary:hover {
		transform: translateY(-2px);
		box-shadow: 0 20px 45px rgba(241, 200, 75, 0.5);
	}

	.nnpc-btn-outline {
		border: 1px solid rgba(15, 12, 6, 0.25);
		color: #1f1608;
		background: rgba(255, 255, 255, 0.7);
	}

	.nnpc-btn-outline:hover {
		transform: translateY(-2px);
		background: rgba(241, 200, 75, 0.12);
	}

	.nnpc-link {
		color: rgba(30, 26, 18, 0.7);
		transition: color 0.2s ease;
	}

	.nnpc-link:hover {
		color: var(--gold);
	}

	.nnpc-dot {
		width: 0.55rem;
		height: 0.55rem;
		border-radius: 999px;
		background: radial-gradient(circle, rgba(241, 200, 75, 0.95), rgba(241, 200, 75, 0.2));
		box-shadow: 0 0 12px rgba(241, 200, 75, 0.7);
	}

	.nnpc-dot-dark {
		background: radial-gradient(circle, rgba(200, 160, 45, 0.95), rgba(200, 160, 45, 0.2));
		box-shadow: 0 0 12px rgba(200, 160, 45, 0.4);
	}

	.nnpc-highlight {
		color: #1a1a1a;
		background: linear-gradient(120deg, rgba(241, 200, 75, 0.35), rgba(241, 200, 75, 0.35));
		padding: 0 0.2rem;
	}

	.nnpc-image-frame {
		position: relative;
		overflow: hidden;
		border-radius: 1.5rem;
		box-shadow: 0 20px 40px rgba(22, 16, 8, 0.15);
		transform: rotate(-1.5deg);
		transition: transform 0.4s ease;
		background: #fffaf0;
		min-height: 320px;
		display: grid;
		place-items: center;
	}

	.nnpc-image-frame:hover {
		transform: rotate(0deg) scale(1.02);
	}

	.nnpc-image-frame img {
		display: block;
		width: 100%;
		height: auto;
		filter: grayscale(100%);
		transition: filter 0.4s ease;
	}

	.nnpc-image-frame:hover img {
		filter: grayscale(0%);
	}

	.nnpc-image-placeholder {
		display: grid;
		place-items: center;
		width: 100%;
		height: 100%;
		background: linear-gradient(135deg, rgba(241, 200, 75, 0.22), rgba(255, 255, 255, 0.9));
		color: rgba(22, 18, 10, 0.7);
		font-size: 0.85rem;
		letter-spacing: 0.2em;
		text-transform: uppercase;
	}

	.nnpc-caption {
		margin-top: 1rem;
		font-size: 0.8rem;
		letter-spacing: 0.16em;
		text-transform: uppercase;
		color: var(--gold-ink);
	}

	.nnpc-partner-image {
		border-radius: 1rem;
		border: 1px solid rgba(12, 10, 6, 0.08);
		padding: 0.75rem;
		background: rgba(255, 255, 255, 0.7);
		display: flex;
		align-items: center;
		justify-content: center;
		height: 96px;
	}

	.nnpc-partner-image img {
		max-height: 80px;
		width: auto;
		object-fit: contain;
		filter: grayscale(100%);
		opacity: 0.9;
	}

	.nnpc-partner-placeholder {
		width: 100%;
		height: 100%;
		border-radius: 0.85rem;
		border: 1px dashed rgba(14, 12, 8, 0.2);
		display: flex;
		align-items: center;
		justify-content: center;
		color: var(--gold-ink);
		font-size: 0.8rem;
		letter-spacing: 0.18em;
		text-transform: uppercase;
	}

	.nnpc-industry-card {
		background: rgba(255, 255, 255, 0.82);
		border: 1px solid rgba(18, 14, 8, 0.08);
		border-radius: 1.5rem;
		padding: 2rem;
		backdrop-filter: blur(8px);
		box-shadow: 0 15px 30px rgba(20, 16, 10, 0.08);
		transition: transform 0.3s ease, border-color 0.3s ease;
	}

	.nnpc-industry-card:hover {
		transform: translateY(-6px);
		border-color: rgba(241, 200, 75, 0.6);
	}

	.nnpc-label {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		font-size: 0.85rem;
		letter-spacing: 0.12em;
		font-weight: 700;
	}

	.nnpc-label-problem {
		color: #5a4a2a;
	}

	.nnpc-label-solution {
		color: var(--gold-ink);
	}

	.nnpc-field-label {
		display: block;
		font-size: 0.85rem;
		letter-spacing: 0.06em;
		color: rgba(30, 24, 16, 0.7);
		margin-bottom: 0.5rem;
	}

	.nnpc-field {
		width: 100%;
		border-radius: 0.9rem;
		border: 1px solid rgba(18, 14, 8, 0.12);
		background: rgba(255, 255, 255, 0.95);
		padding: 0.9rem 1rem;
		color: #16120a;
		font-size: 0.95rem;
		transition: border-color 0.3s ease, box-shadow 0.3s ease;
	}

	.nnpc-field:focus {
		outline: none;
		border-color: rgba(241, 200, 75, 0.6);
		box-shadow: 0 0 0 3px rgba(241, 200, 75, 0.15);
	}

	select.nnpc-field {
		appearance: none;
		padding-right: 2.5rem;
		background-image:
			linear-gradient(45deg, transparent 50%, rgba(241, 200, 75, 0.7) 50%),
			linear-gradient(135deg, rgba(241, 200, 75, 0.7) 50%, transparent 50%);
		background-position: calc(100% - 18px) 50%, calc(100% - 12px) 50%;
		background-size: 6px 6px, 6px 6px;
		background-repeat: no-repeat;
	}

	.nnpc-footer {
		background: #f7f2e8;
		border-top: 1px solid rgba(18, 14, 8, 0.08);
	}

	[data-reveal] {
		opacity: 0;
		transform: translateY(22px);
		transition: opacity 0.7s ease, transform 0.7s ease;
		transition-delay: var(--delay, 0ms);
	}

	[data-reveal].is-visible {
		opacity: 1;
		transform: translateY(0);
	}

	@media (max-width: 768px) {
		.nnpc-hero,
		.nnpc-hero-inner {
			min-height: 90vh;
		}

		.nnpc-btn {
			width: 100%;
		}

		.nnpc-image-frame {
			min-height: 240px;
			transform: none;
		}
	}

	@media (prefers-reduced-motion: reduce) {
		[data-reveal] {
			animation: none;
			transition: none;
		}
	}
</style>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const prefersReduced = window.matchMedia(
			"(prefers-reduced-motion: reduce)"
		).matches;
		const revealItems = document.querySelectorAll("[data-reveal]");

		const revealAll = () => {
			revealItems.forEach((item) => item.classList.add("is-visible"));
		};

		if (prefersReduced) {
			revealAll();
			return;
		}

		if ("IntersectionObserver" in window) {
			const observer = new IntersectionObserver(
				(entries, obs) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							entry.target.classList.add("is-visible");
							obs.unobserve(entry.target);
						}
					});
				},
				{ threshold: 0.2 }
			);

			revealItems.forEach((item) => observer.observe(item));
		} else {
			revealAll();
		}

	});
</script>
